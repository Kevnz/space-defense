(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";
var globals = {
  bullets: null,
  enemies: null,
  player: null
};
var update = require('./game/update');
var preload = require('./game/preload');
var create = require('./game/create');
var game = window.game = new Phaser.Game(800, 600, Phaser.AUTO, '', {
  preload: preload,
  create: create,
  update: update
});


},{"./game/create":2,"./game/preload":3,"./game/update":4}],2:[function(require,module,exports){
"use strict";
function resetBullet(bullet) {
  bullet.kill();
}
;
module.exports = function() {
  console.log(this);
  this.spaceBG = this.add.tileSprite(0, 0, 800, 600, 'bg');
  this.spaceBG.autoScroll(0, 75);
  var ef = window.ef = this.add.sprite((400 - 16), 10, 'atlas');
  ef.frameName = "bad-guy1.png";
  var player = window.player = this.add.sprite((400 - 16), 500, 'ship');
  var cursors = window.cursors = this.input.keyboard.createCursorKeys();
  var bullets = window.bullets = this.add.group();
  bullets.enableBody = true;
  bullets.physicsBodyType = Phaser.Physics.ARCADE;
  bullets.createMultiple(10, 'bullets');
  bullets.setAll('anchor.x', 0.5);
  bullets.setAll('anchor.y', 1);
  bullets.setAll('outOfBoundsKill', true);
  bullets.setAll('checkWorldBounds', true);
};


},{}],3:[function(require,module,exports){
"use strict";
module.exports = function() {
  this.load.atlas('bullets', 'img/assets/bullets.png', 'img/assets/bullets.json');
  this.load.image('bg', 'img/backgrounds/bg.png');
  this.load.image('ship', 'img/space_ship_base.png');
  this.load.atlas('atlas', 'img/enemy-fighters/enemy-fighters.png', 'img/enemy-fighters/enemy-fighters.json');
  this.load.image('ship', 'img/space_ship_base.png');
};


},{}],4:[function(require,module,exports){
"use strict";
var bulletTime = 0;
function resetBullet(bullet) {
  bullet.kill();
}
;
function collisionHandler(bullet, alien) {
  console.log(arguments);
  bullet.kill();
  alien.kill();
}
;
module.exports = function() {
  var bullets = window.bullets;
  var right_bulletTime = 0,
      left_bulletTime = 0;
  var game = window.game;
  var cursors = window.cursors;
  function fireBullet() {
    if (game.time.now > right_bulletTime) {
      var right_bullet = bullets.getFirstExists(false);
      if (right_bullet) {
        right_bullet.reset(player.x, player.y + 16);
        right_bullet.body.velocity.y = -300;
        right_bulletTime = game.time.now + 200;
      }
    }
    if (game.time.now > left_bulletTime) {
      var left_bullet = bullets.getFirstExists(false);
      if (left_bullet) {
        left_bullet.reset(player.x + 26, player.y + 16);
        left_bullet.body.velocity.y = -300;
        left_bulletTime = game.time.now + 200;
      }
    }
  }
  if (cursors.up.isDown) {
    if (cursors.up.shiftKey) {} else {
      if (player.y > 350)
        player.y -= 4;
    }
  } else if (cursors.down.isDown) {
    if (cursors.down.shiftKey) {} else {
      player.y += 4;
    }
  }
  if (cursors.left.isDown) {
    player.x -= 4;
  } else if (cursors.right.isDown) {
    player.x += 4;
  }
  if (this.input.keyboard.isDown(Phaser.Keyboard.SPACEBAR)) {
    fireBullet();
  }
  game.physics.arcade.overlap(bullets, ef, collisionHandler, null, this);
};


},{}]},{},[1])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlcyI6WyJDOlxcVXNlcnNcXEtldmluXFxQcm9qZWN0c1xcc3BhY2UtZGVmZW5zZVxcbm9kZV9tb2R1bGVzXFxicm93c2VyaWZ5XFxub2RlX21vZHVsZXNcXGJyb3dzZXItcGFja1xcX3ByZWx1ZGUuanMiLCJDOlxcVXNlcnNcXEtldmluXFxQcm9qZWN0c1xcc3BhY2UtZGVmZW5zZVxccHVibGljXFxqc1xcZ2FtZS5qcyIsIkM6XFxVc2Vyc1xcS2V2aW5cXFByb2plY3RzXFxzcGFjZS1kZWZlbnNlXFxwdWJsaWNcXGpzXFxnYW1lXFxjcmVhdGUuanMiLCJDOlxcVXNlcnNcXEtldmluXFxQcm9qZWN0c1xcc3BhY2UtZGVmZW5zZVxccHVibGljXFxqc1xcZ2FtZVxccHJlbG9hZC5qcyIsIkM6XFxVc2Vyc1xcS2V2aW5cXFByb2plY3RzXFxzcGFjZS1kZWZlbnNlXFxwdWJsaWNcXGpzXFxnYW1lXFx1cGRhdGUuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNBQTtBQUFJLENBQUosRUFBSSxDQUFBLE9BQU8sRUFBRztBQUNWLENBQUEsUUFBTyxDQUFFLEtBQUk7QUFDYixDQUFBLFFBQU8sQ0FBRSxLQUFJO0FBQ2IsQ0FBQSxPQUFNLENBQUUsS0FBSTtDQUFBLEFBQ2YsQ0FBQTtBQUNHLENBQUosRUFBSSxDQUFBLE1BQU0sRUFBRyxDQUFBLE9BQU8sQ0FBQyxlQUFlLENBQUMsQ0FBQztBQUNsQyxDQUFKLEVBQUksQ0FBQSxPQUFPLEVBQUcsQ0FBQSxPQUFPLENBQUMsZ0JBQWdCLENBQUMsQ0FBRTtBQUNyQyxDQUFKLEVBQUksQ0FBQSxNQUFNLEVBQUcsQ0FBQSxPQUFPLENBQUMsZUFBZSxDQUFDLENBQUM7QUFFbEMsQ0FBSixFQUFJLENBQUEsSUFBSSxFQUFHLENBQUEsTUFBTSxLQUFLLEVBQUcsSUFBSSxDQUFBLE1BQU0sS0FBSyxDQUFDLEdBQUcsQ0FBRSxJQUFHLENBQUUsQ0FBQSxNQUFNLEtBQUssQ0FBRSxHQUFF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LHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3Rocm93IG5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIil9dmFyIGY9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGYuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sZixmLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsInZhciBnbG9iYWxzID0ge1xyXG4gICAgYnVsbGV0czogbnVsbCxcclxuICAgIGVuZW1pZXM6IG51bGwsXHJcbiAgICBwbGF5ZXI6IG51bGxcclxufVxyXG52YXIgdXBkYXRlID0gcmVxdWlyZSgnLi9nYW1lL3VwZGF0ZScpO1xyXG52YXIgcHJlbG9hZCA9IHJlcXVpcmUoJy4vZ2FtZS9wcmVsb2FkJykgO1xyXG52YXIgY3JlYXRlID0gcmVxdWlyZSgnLi9nYW1lL2NyZWF0ZScpO1xyXG4gXHJcbnZhciBnYW1lID0gd2luZG93LmdhbWUgPSBuZXcgUGhhc2VyLkdhbWUoODAwLCA2MDAsIFBoYXNlci5BVVRPLCAnJywgeyBwcmVsb2FkOiBwcmVsb2FkLCBjcmVhdGU6IGNyZWF0ZSwgdXBkYXRlOiB1cGRhdGUgfSk7XHJcbiIsIiBmdW5jdGlvbiByZXNldEJ1bGxldCAoYnVsbGV0KSB7XHJcblxyXG4gICAgYnVsbGV0LmtpbGwoKTtcclxuXHJcbn1cclxuO1xyXG5tb2R1bGUuZXhwb3J0cyA9ICAgIGZ1bmN0aW9uKCl7XHJcbiAgICBjb25zb2xlLmxvZyh0aGlzKTtcclxuXHJcblxyXG4gICAgdGhpcy5zcGFjZUJHID0gIHRoaXMuYWRkLnRpbGVTcHJpdGUoMCwgMCwgODAwLCA2MDAsICdiZycpOyAgXHJcbiAgICB0aGlzLnNwYWNlQkcuYXV0b1Njcm9sbCgwLCA3NSk7IFxyXG5cclxuICAgIHZhciBlZiA9IHdpbmRvdy5lZiA9IHRoaXMuYWRkLnNwcml0ZSgoNDAwIC0gMTYpLCAxMCwgJ2F0bGFzJyk7XHJcbiAgICBlZi5mcmFtZU5hbWUgPSBcImJhZC1ndXkxLnBuZ1wiO1xyXG4gICAgdmFyIHBsYXllciA9IHdpbmRvdy5wbGF5ZXIgPSB0aGlzLmFkZC5zcHJpdGUoKDQwMCAtIDE2KSwgNTAwLCAnc2hpcCcpO1xyXG5cclxuICAgIHZhciBjdXJzb3JzID0gd2luZG93LmN1cnNvcnMgPSB0aGlzLmlucHV0LmtleWJvYXJkLmNyZWF0ZUN1cnNvcktleXMoKTtcclxuXHJcbiAgICB2YXIgYnVsbGV0cyA9IHdpbmRvdy5idWxsZXRzID0gdGhpcy5hZGQuZ3JvdXAoKTtcclxuXHJcbiAgICBidWxsZXRzLmVuYWJsZUJvZHkgPSB0cnVlO1xyXG5cclxuICAgIGJ1bGxldHMucGh5c2ljc0JvZHlUeXBlID0gUGhhc2VyLlBoeXNpY3MuQVJDQURFO1xyXG5cclxuICAgIGJ1bGxldHMuY3JlYXRlTXVsdGlwbGUoMTAsICdidWxsZXRzJyk7XHJcbiAgICBidWxsZXRzLnNldEFsbCgnYW5jaG9yLngnLCAwLjUpO1xyXG4gICAgYnVsbGV0cy5zZXRBbGwoJ2FuY2hvci55JywgMSk7XHJcbiAgICBidWxsZXRzLnNldEFsbCgnb3V0T2ZCb3VuZHNLaWxsJywgdHJ1ZSk7XHJcbiAgICBidWxsZXRzLnNldEFsbCgnY2hlY2tXb3JsZEJvdW5kcycsIHRydWUpO1xyXG59XHJcblxyXG4gIiwibW9kdWxlLmV4cG9ydHMgPSAgZnVuY3Rpb24gKCkge1xyXG4gXHJcbiAgICAvL3RoaXMubG9hZC5pbWFnZSgnZW5lbXlGaWdodGVyJywgJ2ltZy9lbmVteS1maWdodGVycy9iYWQtZ3V5MS1hLnBuZycpO1xyXG4gICAgdGhpcy5sb2FkLmF0bGFzKCdidWxsZXRzJywgJ2ltZy9hc3NldHMvYnVsbGV0cy5wbmcnLCAnaW1nL2Fzc2V0cy9idWxsZXRzLmpzb24nKTtcclxuICAgIHRoaXMubG9hZC5pbWFnZSgnYmcnLCAnaW1nL2JhY2tncm91bmRzL2JnLnBuZycpO1xyXG4gICAgdGhpcy5sb2FkLmltYWdlKCdzaGlwJywgJ2ltZy9zcGFjZV9zaGlwX2Jhc2UucG5nJyk7XHJcbiAgICB0aGlzLmxvYWQuYXRsYXMoJ2F0bGFzJywgJ2ltZy9lbmVteS1maWdodGVycy9lbmVteS1maWdodGVycy5wbmcnLCAnaW1nL2VuZW15LWZpZ2h0ZXJzL2VuZW15LWZpZ2h0ZXJzLmpzb24nKTtcclxuICAgIHRoaXMubG9hZC5pbWFnZSgnc2hpcCcsICdpbWcvc3BhY2Vfc2hpcF9iYXNlLnBuZycpO1xyXG5cclxufSIsInZhciBidWxsZXRUaW1lID0gMDtcclxuIGZ1bmN0aW9uIHJlc2V0QnVsbGV0IChidWxsZXQpIHtcclxuXHJcbiAgICBidWxsZXQua2lsbCgpO1xyXG5cclxufTtcclxuXHJcbmZ1bmN0aW9uIGNvbGxpc2lvbkhhbmRsZXIgKGJ1bGxldCwgYWxpZW4pIHtcclxuY29uc29sZS5sb2coYXJndW1lbnRzKTtcclxuICAgIC8vICBXaGVuIGEgYnVsbGV0IGhpdHMgYW4gYWxpZW4gd2Uga2lsbCB0aGVtIGJvdGhcclxuICAgIGJ1bGxldC5raWxsKCk7XHJcbiAgICBhbGllbi5raWxsKCk7XHJcblxyXG4gICAgLy8gIEluY3JlYXNlIHRoZSBzY29yZVxyXG4gICAvLyBzY29yZSArPSAyMDtcclxuICAgIC8vc2NvcmVUZXh0LnRleHQgPSBzY29yZVN0cmluZyArIHNjb3JlO1xyXG5cclxuICAgIC8vICBBbmQgY3JlYXRlIGFuIGV4cGxvc2lvbiA6KVxyXG4gICAgLy92YXIgZXhwbG9zaW9uID0gZXhwbG9zaW9ucy5nZXRGaXJzdEV4aXN0cyhmYWxzZSk7XHJcbiAgICAvL2V4cGxvc2lvbi5yZXNldChhbGllbi5ib2R5LngsIGFsaWVuLmJvZHkueSk7XHJcbiAgICAvL2V4cGxvc2lvbi5wbGF5KCdrYWJvb20nLCAzMCwgZmFsc2UsIHRydWUpO1xyXG5cclxuICAgIC8vaWYgKGFsaWVucy5jb3VudExpdmluZygpID09IDApXHJcbiAgICAvL3tcclxuICAgICAgIC8vIHNjb3JlICs9IDEwMDA7XHJcbiAgICAgIC8vICBzY29yZVRleHQudGV4dCA9IHNjb3JlU3RyaW5nICsgc2NvcmU7XHJcblxyXG4gICAgICAgLy8gZW5lbXlCdWxsZXRzLmNhbGxBbGwoJ2tpbGwnLHRoaXMpO1xyXG4gICAgICAgLy8gc3RhdGVUZXh0LnRleHQgPSBcIiBZb3UgV29uLCBcXG4gQ2xpY2sgdG8gcmVzdGFydFwiO1xyXG4gICAgICAgLy8gc3RhdGVUZXh0LnZpc2libGUgPSB0cnVlO1xyXG5cclxuICAgICAgICAvL3RoZSBcImNsaWNrIHRvIHJlc3RhcnRcIiBoYW5kbGVyXHJcbiAgICAgIC8vICBnYW1lLmlucHV0Lm9uVGFwLmFkZE9uY2UocmVzdGFydCx0aGlzKTtcclxuICAgIC8vfVxyXG59O1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSAgZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIGJ1bGxldHMgPSB3aW5kb3cuYnVsbGV0cztcclxuICAgIHZhciByaWdodF9idWxsZXRUaW1lID0gMCwgbGVmdF9idWxsZXRUaW1lID0gMDsgXHJcbiBcclxuICAgIHZhciBnYW1lID0gd2luZG93LmdhbWU7XHJcbiAgICB2YXIgY3Vyc29ycyA9IHdpbmRvdy5jdXJzb3JzOyBcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZmlyZUJ1bGxldCAoKSB7IFxyXG4gICAgICAgICAgICBpZiAoIGdhbWUudGltZS5ub3cgPiByaWdodF9idWxsZXRUaW1lKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmlnaHRfYnVsbGV0ID0gYnVsbGV0cy5nZXRGaXJzdEV4aXN0cyhmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICBpZiAocmlnaHRfYnVsbGV0KVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vICBBbmQgZmlyZSBpdFxyXG4gICAgICAgICAgICAgICAgICAgIHJpZ2h0X2J1bGxldC5yZXNldChwbGF5ZXIueCwgcGxheWVyLnkgKyAxNik7XHJcbiAgICAgICAgICAgICAgICAgICAgcmlnaHRfYnVsbGV0LmJvZHkudmVsb2NpdHkueSA9IC0zMDA7XHJcbiAgICAgICAgICAgICAgICAgICAgcmlnaHRfYnVsbGV0VGltZSA9IGdhbWUudGltZS5ub3cgKyAyMDA7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCBnYW1lLnRpbWUubm93ID4gbGVmdF9idWxsZXRUaW1lKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB2YXIgbGVmdF9idWxsZXQgPSBidWxsZXRzLmdldEZpcnN0RXhpc3RzKGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIGlmIChsZWZ0X2J1bGxldClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyAgQW5kIGZpcmUgaXRcclxuICAgICAgICAgICAgICAgICAgICBsZWZ0X2J1bGxldC5yZXNldChwbGF5ZXIueCArIDI2LCBwbGF5ZXIueSArIDE2KTtcclxuICAgICAgICAgICAgICAgICAgICBsZWZ0X2J1bGxldC5ib2R5LnZlbG9jaXR5LnkgPSAtMzAwO1xyXG4gICAgICAgICAgICAgICAgICAgIGxlZnRfYnVsbGV0VGltZSA9IGdhbWUudGltZS5ub3cgKyAyMDA7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vICBGb3IgZXhhbXBsZSB0aGlzIGNoZWNrcyBpZiB0aGUgdXAgb3IgZG93biBrZXlzIGFyZSBwcmVzc2VkIGFuZCBtb3ZlcyB0aGUgY2FtZXJhIGFjY29yZGluZ2x5LlxyXG4gICAgICAgIGlmIChjdXJzb3JzLnVwLmlzRG93bilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIC8vICBJZiB0aGUgc2hpZnQga2V5IGlzIGFsc28gcHJlc3NlZCB0aGVuIHRoZSB3b3JsZCBpcyByb3RhdGVkXHJcbiAgICAgICAgICAgIGlmIChjdXJzb3JzLnVwLnNoaWZ0S2V5KVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAvL2dhbWUud29ybGQucm90YXRpb24gKz0gMC4wNTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmKHBsYXllci55ID4gMzUwKSBwbGF5ZXIueSAtPSA0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKGN1cnNvcnMuZG93bi5pc0Rvd24pXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAoY3Vyc29ycy5kb3duLnNoaWZ0S2V5KVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAvL2dhbWUud29ybGQucm90YXRpb24gLT0gMC4wNTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHBsYXllci55ICs9IDQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGN1cnNvcnMubGVmdC5pc0Rvd24pXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBwbGF5ZXIueCAtPSA0O1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChjdXJzb3JzLnJpZ2h0LmlzRG93bilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgcGxheWVyLnggKz0gNDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuaW5wdXQua2V5Ym9hcmQuaXNEb3duKFBoYXNlci5LZXlib2FyZC5TUEFDRUJBUikpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBmaXJlQnVsbGV0KCkgO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvL2NvbnNvbGUubG9nKGN1cnNvcnMpO1xyXG4gICAgICAgICBnYW1lLnBoeXNpY3MuYXJjYWRlLm92ZXJsYXAoYnVsbGV0cywgZWYsIGNvbGxpc2lvbkhhbmRsZXIsIG51bGwsIHRoaXMpO1xyXG59Il19
